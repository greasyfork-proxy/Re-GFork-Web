<!doctype html><html lang="zh-TW"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>腳本連結安全重新導向</title><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3758644447684310" crossorigin="anonymous"></script><link rel="stylesheet" href="https://cdn.jsdmirror.com/gh/greasyfork-proxy/re-gfork-web@main/css/mater.css"><link rel="stylesheet" href="https://fonts.loli.net/icon?family=Material+Icons"><style>:root{--md-sys-color-primary:#5A7D6B;--md-sys-color-on-primary:#FFFFFF;--md-sys-color-primary-container:#C8D9D0;--md-sys-color-on-primary-container:#2C3E35;--md-sys-color-secondary:#6E7D75;--md-sys-color-on-secondary:#FFFFFF;--md-sys-color-secondary-container:#D5E0DA;--md-sys-color-on-secondary-container:#353E3A;--md-sys-color-tertiary:#758075;--md-sys-color-error:#BA1A1A;--md-sys-color-on-error:#FFFFFF;--md-sys-color-error-container:#FFDAD6;--md-sys-color-on-error-container:#410002;--md-sys-color-background:#E8E8E8;--md-sys-color-on-background:#3A3A3A;--md-sys-color-surface:#F5F5F5;--md-sys-color-on-surface:#3A3A3A;--md-sys-color-surface-variant:#D8D8D8;--md-sys-color-on-surface-variant:#505050;--md-sys-color-outline:#909090;--md-sys-color-outline-variant:#C0C0C0;--md-sys-color-success:#5A7D6B;--md-sys-color-on-success:#FFFFFF;--md-sys-color-success-container:#C8D9D0;--md-sys-color-warning:#785900;--md-sys-color-on-warning:#FFFFFF;--md-sys-color-warning-container:#FFDDB3;--md-sys-color-on-warning-container:#261A00;--md-sys-elevation-level0:none;--md-sys-elevation-level1:0px 1px 3px 1px rgba(0,0,0,0.15),0px 1px 2px 0px rgba(0,0,0,0.30);--md-sys-elevation-level2:0px 2px 6px 2px rgba(0,0,0,0.15),0px 1px 2px 0px rgba(0,0,0,0.30);--md-sys-elevation-level3:0px 4px 8px 3px rgba(0,0,0,0.15),0px 1px 3px 0px rgba(0,0,0,0.30)}*{margin:0;padding:0;box-sizing:border-box}body{font-family:"Noto Sans SC","Noto Emoji",Roboto,Arial,sans-serif;background-color:var(--md-sys-color-background);color:var(--md-sys-color-on-background);min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:24px;line-height:1.5}.main-container{max-width:640px;width:100%}.ad-slot{margin:16px 0;min-height:50px;background:var(--md-sys-color-surface-variant);border-radius:12px;display:flex;align-items:center;justify-content:center;opacity:0.6}.status-card{background:var(--md-sys-color-surface);border-radius:28px;padding:40px 32px;box-shadow:var(--md-sys-elevation-level2);text-align:center;animation:slideIn 0.4s cubic-bezier(0.4,0,0.2,1);position:relative;overflow:hidden}@keyframes slideIn{from{opacity:0;transform:translateY(-16px) scale(0.96)}to{opacity:1;transform:translateY(0) scale(1)}}.state-layer{position:absolute;top:0;left:0;right:0;height:4px;overflow:hidden}.state-layer.checking::before{content:'';position:absolute;width:40%;height:100%;background:var(--md-sys-color-primary);animation:indeterminate 2s cubic-bezier(0.4,0,0.2,1) infinite}@keyframes indeterminate{0%{left:-40%}100%{left:100%}}.icon-container{width:80px;height:80px;margin:0 auto 24px;border-radius:50%;display:flex;align-items:center;justify-content:center;position:relative}.waiting .icon-container{background-color:var(--md-sys-color-secondary-container)}.success .icon-container{background-color:var(--md-sys-color-success-container)}.error .icon-container{background-color:var(--md-sys-color-error-container)}.checking .icon-container{background-color:var(--md-sys-color-primary-container)}.icon-container .material-icons{font-size:40px}.waiting .icon-container .material-icons{color:var(--md-sys-color-on-secondary-container)}.success .icon-container .material-icons{color:var(--md-sys-color-success)}.error .icon-container .material-icons{color:var(--md-sys-color-error)}.checking .icon-container .material-icons{color:var(--md-sys-color-on-primary-container)}.icon-spin{animation:spin 2s linear infinite}@keyframes spin{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}.headline{font-size:24px;font-weight:500;margin-bottom:12px;color:var(--md-sys-color-on-surface);letter-spacing:0}.body-text{font-size:16px;color:var(--md-sys-color-on-surface-variant);line-height:24px;margin-bottom:24px;letter-spacing:0.5px}.url-display{background:var(--md-sys-color-surface-variant);border-radius:12px;padding:16px;margin:24px 0;word-break:break-all;font-family:"Roboto Mono","Courier New",monospace;font-size:14px;color:var(--md-sys-color-on-surface-variant);display:flex;align-items:flex-start;gap:12px;text-align:left}.url-display .material-icons{color:var(--md-sys-color-primary);flex-shrink:0;font-size:20px}.domain-status{background:var(--md-sys-color-surface-variant);border-radius:12px;padding:16px;margin:24px 0;text-align:left}.domain-status-title{font-size:14px;font-weight:500;color:var(--md-sys-color-on-surface-variant);margin-bottom:12px;letter-spacing:0.1px}.checking-domain{display:flex;align-items:center;gap:12px;padding:8px 0;font-size:14px;color:var(--md-sys-color-on-surface-variant)}.checking-domain .material-icons{font-size:20px;color:var(--md-sys-color-primary)}.checking-domain.failed-domain{text-decoration:line-through;opacity:0.5}.checking-domain.failed-domain .material-icons{color:var(--md-sys-color-error)}.checking-domain.success-domain .material-icons{color:var(--md-sys-color-success)}.actions{display:flex;gap:12px;justify-content:center;flex-wrap:wrap;margin-top:24px}.md-filled-button{display:inline-flex;align-items:center;gap:8px;padding:10px 24px;height:40px;background:var(--md-sys-color-primary);color:var(--md-sys-color-on-primary);text-decoration:none;border-radius:20px;font-weight:500;font-size:14px;letter-spacing:0.1px;border:none;cursor:pointer;transition:all 0.2s cubic-bezier(0.4,0,0.2,1);box-shadow:var(--md-sys-elevation-level1);position:relative;overflow:hidden}.md-filled-button::before{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:var(--md-sys-color-on-primary);opacity:0;transition:opacity 0.2s}.md-filled-button:hover::before{opacity:0.08}.md-filled-button:active{box-shadow:var(--md-sys-elevation-level1)}.md-filled-button .material-icons{font-size:18px;position:relative;z-index:1}.md-filled-button span{position:relative;z-index:1}.md-outlined-button{display:inline-flex;align-items:center;gap:8px;padding:10px 24px;height:40px;background:transparent;color:var(--md-sys-color-primary);text-decoration:none;border-radius:20px;font-weight:500;font-size:14px;letter-spacing:0.1px;border:1px solid var(--md-sys-color-outline);cursor:pointer;transition:all 0.2s cubic-bezier(0.4,0,0.2,1);position:relative;overflow:hidden}.md-outlined-button::before{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:var(--md-sys-color-primary);opacity:0;transition:opacity 0.2s}.md-outlined-button:hover::before{opacity:0.08}.md-outlined-button .material-icons{font-size:18px;position:relative;z-index:1}.md-outlined-button span{position:relative;z-index:1}.tips-card{background:var(--md-sys-color-warning-container);border-radius:12px;padding:16px;margin-top:24px;display:flex;align-items:flex-start;gap:12px;text-align:left}.tips-card .material-icons{color:var(--md-sys-color-warning);flex-shrink:0;font-size:24px}.tips-text{font-size:14px;color:var(--md-sys-color-on-surface-variant);line-height:20px;letter-spacing:0.25px}.progress-indicator{width:100%;height:4px;background:var(--md-sys-color-surface-variant);border-radius:2px;margin:24px 0;overflow:hidden}.progress-fill{height:100%;background:var(--md-sys-color-primary);transition:width 1s cubic-bezier(0.4,0,0.2,1);border-radius:2px}.cache-badge{display:inline-flex;align-items:center;gap:4px;padding:4px 12px;background:var(--md-sys-color-success-container);color:var(--md-sys-color-success);border-radius:12px;font-size:12px;font-weight:500;margin-top:8px}.cache-badge .material-icons{font-size:16px}@media (max-width:640px){body{padding:16px}.status-card{padding:32px 24px;border-radius:24px}.headline{font-size:22px}.icon-container{width:64px;height:64px}.icon-container .material-icons{font-size:32px}.actions{flex-direction:column}.md-filled-button,.md-outlined-button{width:100%;justify-content:center}}@media (prefers-color-scheme:dark){:root{--md-sys-color-primary:#9BB5A8;--md-sys-color-on-primary:#2C3E35;--md-sys-color-primary-container:#435A4E;--md-sys-color-on-primary-container:#C8D9D0;--md-sys-color-secondary:#B0BFBA;--md-sys-color-on-secondary:#353E3A;--md-sys-color-secondary-container:#4A5550;--md-sys-color-on-secondary-container:#D5E0DA;--md-sys-color-error:#C8C8C8;--md-sys-color-on-error:#3A3A3A;--md-sys-color-error-container:#555555;--md-sys-color-on-error-container:#E8E8E8;--md-sys-color-background:#2A2A2A;--md-sys-color-on-background:#E0E0E0;--md-sys-color-surface:#2A2A2A;--md-sys-color-on-surface:#E0E0E0;--md-sys-color-surface-variant:#3F3F3F;--md-sys-color-on-surface-variant:#C0C0C0;--md-sys-color-outline:#909090;--md-sys-color-outline-variant:#505050;--md-sys-color-success:#9BB5A8;--md-sys-color-on-success:#2C3E35;--md-sys-color-success-container:#435A4E;--md-sys-color-warning:#BCB8A8;--md-sys-color-on-warning:#3A3A2C;--md-sys-color-warning-container:#555548}}</style><script>const DOMAIN_LIST=["https://static-sg-apse1-primary-mirror-aws-s3-cloudfront-public-cdn.dahi.edu.eu.org","https://static-sg-apse1-primary-mirror-aws-s3-cloudfront-public-cdn.dahi.edu.eu.org.cdn.cloudflare.net","https://tencent.api-data-abtest-config.dahi.edu.eu.org","https://eop.api-data-abtest-config.dahi.edu.eu.org","https://aws.api-data-abtest-config.dahi.edu.eu.org"],HEALTH_CHECK_TIMEOUT=2e3,CACHE_EXPIRY_DAYS=3,IP_FETCH_TIMEOUT=3e3;let failedDomains=[],currentCheckingDomain="",currentUserIP=null;async function getCurrentUserIP(){try{const n=new AbortController,s=setTimeout((()=>n.abort()),3e3),e=await fetch("https://www.cloudflare.com/cdn-cgi/trace",{signal:n.signal});clearTimeout(s);const a=(await e.text()).split("\n");for(const n of a)if(n.startsWith("ip=")){currentUserIP=n.split("=")[1].trim(),console.log("📍 當前用戶 IP:",currentUserIP);break}}catch(n){console.warn("⚠️ 獲取用戶 IP 失敗，將跳過快取功能:",n.message)}}function setCookie(n,s,e){const a=new Date;a.setTime(a.getTime()+24*e*60*60*1e3);const t="expires="+a.toUTCString();document.cookie=n+"="+s+";"+t+";path=/;SameSite=Lax"}function getCookie(n){const s=n+"=",e=document.cookie.split(";");for(let n=0;n<e.length;n++){let a=e[n];for(;" "===a.charAt(0);)a=a.substring(1,a.length);if(0===a.indexOf(s))return a.substring(s.length,a.length)}return null}function deleteCookie(n){document.cookie=n+"=;expires=Thu, 01 Jan 1970 00:00:00 UTC;path=/;"}function getCachedFastestDomain(){if(!currentUserIP)return console.log("⚠️ 未獲取到用戶 IP，無法使用快取"),null;const n=getCookie("fastest_domain");if(!n)return console.log("ℹ️ 未找到快取數據"),null;try{const s=JSON.parse(decodeURIComponent(n));if(s.ip!==currentUserIP)return console.log("⚠️ IP 不匹配（快取IP:",s.ip,"當前IP:",currentUserIP,"），清除快取"),deleteCookie("fastest_domain"),null;if(!DOMAIN_LIST.includes(s.domain))return console.log("⚠️ 快取的域名已不在配置列表中，清除快取"),deleteCookie("fastest_domain"),null;const e=(Date.now()-s.timestamp)/864e5;return e>3?(console.log("⚠️ 快取已過期（",e.toFixed(1),"天），清除快取"),deleteCookie("fastest_domain"),null):(console.log("✅ 找到有效快取:",s.domain,"（速度:",s.speed,"ms，快取年齡:",e.toFixed(1),"天）"),s.domain)}catch(n){return console.error("❌ 解析快取數據失敗:",n),deleteCookie("fastest_domain"),null}}function cacheFastestDomain(n,s){if(!currentUserIP)return void console.warn("⚠️ 未獲取到用戶 IP，無法設置快取");const e={ip:currentUserIP,domain:n,speed:s,timestamp:Date.now()};try{setCookie("fastest_domain",encodeURIComponent(JSON.stringify(e)),3),console.log("💾 已快取域名:",n,"| 速度:",s,"ms | IP:",currentUserIP)}catch(n){console.error("❌ 快取設置失敗:",n)}}function extractScriptPath(n){return n&&n.startsWith("#/")?n.substring(2):null}async function startRedirectProcess(n){showChecking(n);const s=DOMAIN_LIST.filter((n=>!failedDomains.includes(n)));if(0===s.length)return showError("所有域名都不可用","所有配置的域名都無法連接，請稍後再試或聯繫管理員");const e=s[Math.floor(Math.random()*s.length)];currentCheckingDomain=e,updateCheckingStatus(e,"checking");if(await checkDomainHealth(e)){updateCheckingStatus(e,"success");const s=`${e}/scripts/${n}`;setTimeout((()=>handleRedirect(s,!1)),500)}else updateCheckingStatus(e,"failed"),failedDomains.push(e),setTimeout((()=>startRedirectProcess(n)),1e3)}async function checkDomainHealth(n){try{const s=new AbortController,e=setTimeout((()=>s.abort()),2e3),a=Date.now(),t=(await fetch(`${n}/gfork`,{method:"GET",signal:s.signal}),Date.now()-a);return clearTimeout(e),cacheFastestDomain(n,t),console.log(`✅ 域名健康檢查通過: ${n} | 響應時間: ${t}ms`),!0}catch(s){return console.error(`❌ 域名健康檢查失敗: ${n}`,s.message),!1}}function showChecking(n){document.getElementById("redirect-container").innerHTML=`\n<div class="status-card checking">\n<div class="state-layer checking"></div>\n<div class="icon-container">\n<span class="material-icons icon-spin">sync</span>\n</div>\n<h1 class="headline">正在檢查域名可用性</h1>\n<p class="body-text">系統正在測試域名連接速度，為您選擇最快的路徑...</p>\n<div class="url-display">\n<span class="material-icons">code</span>\n<span>${n}</span>\n</div>\n<div class="domain-status" id="domain-status">\n<div class="domain-status-title">域名檢查狀態</div>\n<div class="checking-domain">\n<span class="material-icons icon-spin">hourglass_empty</span>\n<span>正在初始化檢查系統...</span>\n</div>\n</div>\n<div class="tips-card">\n<span class="material-icons">info</span>\n<span class="tips-text">系統會自動檢測可用域名，成功後將快取結果 3 天</span>\n</div>\n</div>\n`}function updateCheckingStatus(n,s){const e=document.getElementById("domain-status");if(!e)return;let a='<div class="domain-status-title">域名檢查狀態</div>';failedDomains.forEach((n=>{a+=`\n<div class="checking-domain failed-domain">\n<span class="material-icons">cancel</span>\n<span>${n}</span>\n</div>\n`})),"checking"===s?a+=`\n<div class="checking-domain">\n<span class="material-icons icon-spin">sync</span>\n<span>正在檢查: ${n}</span>\n</div>\n`:"success"===s&&(a+=`\n<div class="checking-domain success-domain">\n<span class="material-icons">check_circle</span>\n<span>檢查成功: ${n}</span>\n</div>\n`),e.innerHTML=a}function handleRedirect(n,s=!1){let e="",a="";s?(e="使用快取的最快域名",a='\n<div class="cache-badge">\n<span class="material-icons">bolt</span>\n<span>快取加速</span>\n</div>\n'):(e="已檢測到可用域名並快取",a='\n<div class="cache-badge">\n<span class="material-icons">save</span>\n<span>已快取 3 天</span>\n</div>\n'),document.getElementById("redirect-container").innerHTML=`\n<div class="status-card success">\n<div class="icon-container">\n<span class="material-icons">check_circle</span>\n</div>\n<h1 class="headline">安全驗證通過</h1>\n<p class="body-text">${e}，即將為您自動跳轉至安全連結位址</p>\n${a}\n<div class="url-display">\n<span class="material-icons">link</span>\n<span>${n}</span>\n</div>\n<div class="progress-indicator">\n<div class="progress-fill" style="width: 100%"></div>\n</div>\n<div class="actions">\n<a href="${n}" class="md-filled-button" rel="noopener noreferrer">\n<span class="material-icons">open_in_new</span>\n<span>立即前往</span>\n</a>\n</div>\n</div>\n`,setTimeout((()=>{window.location.href=n}),1e3)}function showError(n,s){document.getElementById("redirect-container").innerHTML=`\n<div class="status-card error">\n<div class="icon-container">\n<span class="material-icons">error</span>\n</div>\n<h1 class="headline">${n}</h1>\n<p class="body-text">${s}</p>\n${failedDomains.length>0?`\n<div class="domain-status">\n<div class="domain-status-title">已嘗試的域名（${failedDomains.length}/${DOMAIN_LIST.length}）</div>\n${failedDomains.map((n=>`\n<div class="checking-domain failed-domain">\n<span class="material-icons">cancel</span>\n<span>${n}</span>\n</div>\n`)).join("")}\n</div>\n`:""}\n<div class="actions">\n<button onclick="location.reload()" class="md-filled-button">\n<span class="material-icons">refresh</span>\n<span>重新載入</span>\n</button>\n<button onclick="history.back()" class="md-outlined-button">\n<span class="material-icons">arrow_back</span>\n<span>返回上一頁</span>\n</button>\n</div>\n<div class="tips-card">\n<span class="material-icons">lightbulb</span>\n<span class="tips-text">若問題持續發生，請稍後再試或聯繫技術支援</span>\n</div>\n</div>\n`}window.onload=async function(){const{hash:n}=window.location;if("#google_vignette"===n)return showError("連結已失效","此連結已過期或不可用");const s=extractScriptPath(n);if(!s)return showError("無效的連結格式","請確保連結格式正確：#/script-id/script-name.user.js");await getCurrentUserIP();const e=getCachedFastestDomain();if(e){console.log("✅ 使用快取的最快域名:",e);return handleRedirect(`${e}/scripts/${s}`,!0)}console.log("🔍 未找到快取，開始域名健康檢查..."),startRedirectProcess(s)};</script><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KZFGTVN7');</script></head><body><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KZFGTVN7" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="main-container"><div class="ad-slot"><ins class="adsbygoogle" style="display:block" data-ad-format="autorelaxed" data-ad-client="ca-pub-3758644447684310" data-ad-slot="3934604756"></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script></div><div id="redirect-container"><div class="status-card waiting"><div class="icon-container"><span class="material-icons icon-spin">sync</span></div><h1 class="headline">初始化中</h1><p class="body-text">正在檢查重定向連結安全性...</p><div class="tips-card"><span class="material-icons">lightbulb</span><span class="tips-text">提示：若長時間停留在此頁面，請重新進入安裝頁</span></div></div></div><div class="ad-slot"><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-3758644447684310" data-ad-slot="4095096984" data-ad-format="auto" data-full-width-responsive="true"></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script></div></div></body></html>